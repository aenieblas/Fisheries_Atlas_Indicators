#R Script generated by OpenFairViewer (https://github.com/eblondel/OpenFairViewer) on 2021-01-19T07:43:38.059Z
#This script provides a standard way to get data and metadata handled in a OpenFairViewer application 

#Application details: 
# • OpenFairViewer Base URL: https://sdi-lab.d4science.org/sdi-lab/
# • OGC CSW Catalogue URL: https://geonetwork-sdi-lab.d4science.org/geonetwork/srv/eng/csw
#Dataset details: 
# • pid: global_catch_5deg_1m_ird_level0
# • title: Global monthly catch of tuna and tuna-like species (1950-01-01 - 2016-12-31) aggregated by statistical squares of 5° longitude and latitude (IRD level 0)
# • abstract: This dataset lists the global monthly-spatially aggregated catch of tuna and tuna-like species (i.e. billfish,bonitos,and mackerel) from 1950-01-01 to 2016-12-31. Species-specific catches expressed in weight or number are stratified by year,month,vessel flag reporting country,fishing gear,fishing mode (i.e. type of school association) and area (statistical squares of 5° longitude and latitude). This dataset was computed using public domain catch datasets released by the five tuna Regional Fisheries Management Organizations:the Indian Ocean Tuna Commission (IOTC),the International Commission for the Conservation of Atlantic Tunas (ICCAT),the Inter-American Tropical Tuna Commission (IATTC),The Western and Central Pacific Fisheries Commission (WCPFC) and the Commission for the Conservation of Southern Bluefin Tuna (CCSBT). IRD Level 0 stands for the processes applied to the primary datasets by the French National Research Institute for Sustainable Development (IRD).These processes for level 0 at global scale are :- Catch-and-effort data are disseminated in such way that redundancy may exist between the various datasets released,or that dimensions may be split over the datasets for some strata. To cope with these issues and get one single and more complete possible value of catch per stratum (i.e. with all the available dimensions),these datasets had to be merged in specific ways - i.e. not simply merging them but removing the duplicated strata or reassembling the strata with all the available dimensions split over the datasets.- In the overlapping zone between the IATTC and the WCPFC,only data from the IATTC was kept (i.e. for this specific zone,data from the WCPFC was removed). IATTC data was kept rather than WCPFC's because the information on vessel flag reporting country is available in IATTC datasets contrary to WCPFC's ones.- For the Southern Bluefin Tuna,only data from the the Commission for the Conservation of Southern Bluefin Tuna (CCSBT) was kept (i.e. data from the other RFMOs for SBF was removed).- Original code lists have been mapped with standard FAO code lists (for gears,species,flags). These mappings have been done in collaboration with the RFMOs secretariats.In addition,data that were provided at spatial resolutions inferior to 5° x 5°were aggregated to the corresponding 5° x 5°quadrant. Data that were provided at spatial resolutions superior to 5° x 5° were not disaggregated. More details on the processes are provided in the lineage section._ info:Caracteristics,specific issues and problems that need to be taken into account :In addition to the respective specific issues of all the tuna RFMOs datasets,the following issues might be taken into account :- Stratification by vessel flag reporting country is not available for the Western Pacific Ocean. This is due to WCPFC confidentiality policies.- Shark catches are not available for the Western Pacific Ocean,because WCPFC does not provide georeferenced shark catches.- For confidentiality policies,information on flag and school type for the geo-referenced catches is available in separate files for East Pacific Ocean (IATTC) Purse seine datasets. For each stratum,the catch from the flag-detailed dataset was raised to the catch from the school type-detailed dataset to get an estimation of the catches by flag and school type in each stratum.- Some codes could not have been mapped to standard code lists,for some tRFMOs own-defined codes that usually are aggregation of existing codes (e.g. flag IDPH - Indonesia and Philippines for WCPFC; species Otun - other tuna for ICCAT). In those cases,the code for species was set to UNK (Unknown). However,these codes have been mapped with more aggregated code lists i.e. group of species.- Some data can be expressed at spatial resolutions wider than 5° square. - Some data can be expressed at temporal resolutions greater than 1 month.
# • OpenFairViewer Query URL: https://sdi-lab.d4science.org/sdi-lab/
#---------------------------------------------------------------------------------------------------------
#packages
if(!require(ows4R)){
	install.packages("ows4R")
	require(ows4R)
}

if(!require(sp)){
	install.packages("sp")
	require(sp)
}

#Dataset PID
pid <- "global_catch_5deg_1m_ird_level0"

layer <- "global_catch_5deg_1m_ird_level0"

#Connect to OGC CSW Catalogue to get METADATA
CSW <- CSWClient$new(
	url = "https://geonetwork-sdi-lab.d4science.org/geonetwork/srv/eng/csw",
	serviceVersion = "2.0.2",
	logger = "INFO"
)
#Get metadata for dataset 'global_catch_5deg_1m_ird_level0'
md <- CSW$getRecordById(pid, outputSchema = "http://www.isotc211.org/2005/gmd")
fc <- CSW$getRecordById(paste0(pid,"_dsd"), outputSchema = "http://www.isotc211.org/2005/gfc")

#Connect to OGC WFS to get DATA
WFS <- WFSClient$new(
	url = "https://geoserver-sdi-lab.d4science.org/geoserver/sdilab_geoflow/ows",
	serviceVersion = "1.0.0",
	logger = "INFO"
)
#Get feature type for dataset 'global_catch_5deg_1m_ird_level0' (layer = 'global_catch_5deg_1m_ird_level0' )
ft <- WFS$capabilities$findFeatureTypeByName(layer)
#Get data features for dataset 'global_catch_5deg_1m_ird_level0' (layer = 'global_catch_5deg_1m_ird_level0' )
data.sf <- ft$getFeatures(viewparams = "month:1+2+3+4+5+6+7+8+9+10+11+12;quarter:1+2+3+4;year:1950+1951+1952+1953+1954+1955+1956+1957+1958+1959+1960+1961+1962+1963+1964+1965+1966+1967+1968+1969+1970+1971+1972+1973+1974+1975+1976+1977+1978+1979+1980+1981+1982+1983+1984+1985+1986+1987+1988+1989+1990+1991+1992+1993+1994+1995+1996+1997+1998+1999+2000+2001+2002+2003+2004+2005+2006+2007+2008+2009+2010+2011+2012+2013+2014+2015+2016;unit:MT;aggregation_method:none")
data.sp <- as(data.sf, "Spatial")
